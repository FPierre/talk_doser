<!doctype html>
<html lang='fr'>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Talk Doser</title>
  </head>
  <body>
    <p>Nombre de mots différents trouvés</p>
    <ol id='different-words'></ol>

    <p>Mots les plus prononcés</p>
    <ol id='most-used-words'></ol>

    <p>Mots vulgaires</p>
    <ol id='swear-words'></ol>

    <p>Jour avec le plus d'échanges</p>
    <span id='most-spoken-day'></span>

    <script>
      const request = new XMLHttpRequest()

      const mostUsedWords = document.getElementById('most-used-words')
      const swearWords = document.getElementById('swear-words')
      const mostSpokenDay = document.getElementById('most-spoken-day')

      request.onreadystatechange = function () {
        if (request.readyState === 4 && request.status === 200) {
          const response = JSON.parse(request.responseText)
          // console.log(response)

          // Most used words

          let wordsList = ''

          for (const word in response.words) {
            const count = response.words[word].count
            let peopleCount = ''

            for (const person in response.words[word].people) {
              const personPercent = Math.floor((response.words[word].people[person] * 100) / count)
              peopleCount += `${person} : ${personPercent}%`
            }

            wordsList += `<li>${word} : ${count} (${peopleCount})</li>`
          }

          mostUsedWords.innerHTML = wordsList

          // Swear words

          let swearwordsList = ''

          for (const word in response.swearwords) {
            const count = response.swearwords[word].count
            let peopleCount = ''

            for (const person in response.swearwords[word].people) {
              const personPercent = Math.floor((response.swearwords[word].people[person] * 100) / count)
              peopleCount += `${person} : ${personPercent}%`
            }

            swearwordsList += `<li>${word} : ${count} (${peopleCount})</li>`
          }

          swearWords.innerHTML = swearwordsList

          // Most spoken day

          mostSpokenDay.innerText = `${Object.keys(response.dates[0])[0]} (${Object.values(response.dates[0])[0]} échanges)`
        }
      }

      request.open('GET', 'http://localhost:8081')
      request.send()
    </script>
  </body>
</html>
